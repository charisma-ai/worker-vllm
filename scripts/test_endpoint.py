import os

import dotenv
import requests

dotenv.load_dotenv()



prompt = """Title: To the Moon and Back: The Dark Side of the Voyage
Overview: In the 2100s, space travel has become a booming industry, with corporate entities vying to offer the most extravagant experiences to the wealthy elite. The Stellar Voyage is the pinnacle of this opulenceâ€”a state-of-the-art spacecraft equipped with lavish suites, gourmet dining, zero-gravity entertainment, and panoramic views of the lunar surface. As the ship orbits the moon, passengers are promised an unforgettable journey, but the veneer of luxury hides underlying tensions and dangers. The vast emptiness of space, compounded by the isolation of the moon's dark side, becomes a crucible for human ambition, paranoia, and survival, as corporate negligence and the unknown aspects of space reveal themselves in deadly ways.
Tagline: 
Genres: Science Fiction Thriller,Science Fiction
Keywords: 
Characters: [{'scriptName': 'EVE', 'fullName': 'Dr. Evelyn Carter', 'traits': 'Intelligent,Determined,Cynical,Empathetic,Observant', 'conflicts': "Believes that corporate negligence and the dangers of space travel need to be exposed and mitigated, and that Lucas's optimism is naive.", 'personalDrive': None, 'bio': "Dr. Evelyn Carter was once a brilliant aerospace engineer and scientist who worked for a major corporation that pioneered space travel technologies. Her groundbreaking work in spacecraft design and safety protocols earned her accolades and made her a key figure in the industry. However, a catastrophic failure during a test mission, which resulted in multiple fatalities, led to her resignation and retreat from public life. Blamed for the disaster by the corporation, she became disillusioned with the corporate greed driving space exploration. She now seeks to understand the true risks and mysteries of space travel. Eve's presence on the Stellar Voyage is part of her covert investigation into the safety of these luxury journeys and the hidden dangers they might pose."}, {'scriptName': 'DR. STONE', 'fullName': 'Dr. Michael Stone', 'traits': 'Compassionate,Guilt-ridden,Meticulous,Resilient,Reflective', 'conflicts': '', 'personalDrive': 'To atone for his past mistakes by ensuring the health and safety of all passengers onboard the Stellar Voyage, and to rebuild his fractured relationship with Dr. Evelyn Carter.', 'bio': 'Dr. Michael Stone, a renowned medical doctor specializing in space medicine, was one of the leading figures in developing protocols for human health and safety in space travel. He was once a close colleague and friend of Dr. Evelyn Carter, and they collaborated on various projects aimed at improving astronaut health during long-duration missions. However, their relationship soured after the catastrophic failure of the test mission that led to multiple fatalities, a disaster that Michael indirectly contributed to by greenlighting the mission despite knowing about potential health risks. Wracked with guilt and desperate to make amends, Michael took a leave of absence and eventually joined the Stellar Voyage as the chief medical officer, hoping to ensure that no such tragedy happens again and to find redemption for his past mistakes.'}, {'scriptName': 'CAPTAIN HAYES', 'fullName': 'Captain Jonathan Hayes', 'traits': 'Honorable,Haunted,Protective,Authoritative,Resilient', 'conflicts': 'Believes that safety protocols and cautious behavior are paramount to the success of the mission.', 'personalDrive': "Jonathan's primary drive is to ensure the safety of his passengers and crew, driven by a need to redeem himself for past failures. He is determined to uncover any potential threats to the Stellar Voyage, even if it means clashing with the corporate executives who prioritize profit over safety.", 'bio': "Captain Jonathan Hayes was born and raised in a family with a strong military tradition. His father was a decorated astronaut who led several pioneering missions to Mars. Jonathan, driven by a desire to live up to his father's legacy, joined the space corps and quickly rose through the ranks due to his exceptional leadership skills and tactical acumen. However, during a critical rescue mission on a lunar station, a split-second decision led to the death of several crew members, a tragedy for which Jonathan has never forgiven himself. Discharged from the space corps, he found a second chance as the captain of the Stellar Voyage, a position that allows him to stay connected to space while avoiding the high-stakes pressures of military missions. Despite the commercial nature of his current role, Jonathan harbors deep concerns about the safety of the spaceship and the competence of its corporate backers."}, {'scriptName': 'AMANDA', 'fullName': 'Amanda Wallace', 'traits': 'Ambitious,Curious,Determined,Skeptical,Brave', 'conflicts': '', 'personalDrive': None, 'bio': "Amanda Wallace, at 32, is an investigative journalist for a renowned space exploration magazine. She grew up fascinated by the stars, driven by her father's stories of the Apollo missions and his own failed dreams of becoming an astronaut. Amanda's career took off when she exposed a major corporate scandal involving safety violations at a prominent space travel company. Her relentless pursuit of the truth earned her both acclaim and enemies within the industry. Amanda's invitation to the Stellar Voyage was part of an exclusive media tour, but she has a hidden agenda: to uncover any potential cover-ups or safety issues, following a tip-off that the luxury liner might not be as safe as advertised. Her goal is not just a career-defining story but to vindicate her father's belief in the integrity of space travel."}, {'scriptName': 'SOPHIA', 'fullName': 'Sophia Reynolds', 'traits': 'Ambitious,Inquisitive,Resourceful,Conflicted,Compassionate', 'conflicts': "Is unaware of Lucas's past and interprets his erratic behavior as a sign of instability, creating distrust.", 'personalDrive': "To uncover the truth about her father's death and reform the space tourism industry, making it safer and more ethical.", 'bio': "Sophia Reynolds grew up in a wealthy family that made its fortune through investments in the burgeoning space tourism industry. From a young age, she was groomed to take over the family business, Reynolds Aerospace Holdings. Despite her privileged upbringing, Sophia was never content with living in her parents' shadow. She pursued advanced degrees in astrophysics and business management, hoping to prove her worth and reform the industry from within. Her father's recent death from a mysterious accident on one of their company's spacecraft has left her determined to uncover the truth behind it. Sophia's presence on the Stellar Voyage is part of her quest to investigate the safety of their luxury journeys and to find any evidence of foul play or corporate negligence that may have caused her father's death."}, {'scriptName': 'LUCAS', 'fullName': 'Lucas Trent', 'traits': 'Charismatic,Determined,Reckless,Haunted,Resilient', 'conflicts': 'Believes facing the unknown is essential to overcoming his past and proving his worth.;Feels the need to take risks to demonstrate his capability and bravery.;Struggles to maintain his composure and often reacts defensively to perceived slights.', 'personalDrive': 'To confront and overcome his psychological traumas from past space missions, and to prove to himself and others that he is not defined by his past failures.', 'bio': 'Lucas Trent is a former astronaut who was once the poster child for the next generation of space explorers. He participated in numerous missions, including the first manned mission to Mars. His experience and charisma made him a media darling and a symbol of human ambition. However, during a mission to establish a permanent outpost on Mars, Lucas experienced a severe psychological breakdown due to prolonged isolation and the stresses of space travel. He was forced to retire early and has since struggled with feelings of inadequacy and a loss of purpose. He boarded the Stellar Voyage hoping to rediscover his love for space and to prove to himself that he can overcome his past traumas.'}]"""

prompt = prompt  # DS_FORMAT.replace("{instruction}", prompt)
input_payload = {
    "input":{
        "prompt": prompt,
        "sampling_params": {"max_tokens": 2048},
        "stream": True,
        "apply_chat_template": True,
    }
}

resp = requests.post("http://localhost:8000/run",headers={"Content-Type": "application/json"},json=input_payload)
j = resp.json()
print(j)

with requests.post(f"http://localhost:8000/stream/{j['id']}",headers={"Content-Type": "application/json"},stream=True) as r:    
    for output in r.iter_content(chunk_size=None):    
        print(output)    
        # tokens = output.json()["choices"][0]["tokens"]
        # print("".join(tokens), flush=True, end="")
